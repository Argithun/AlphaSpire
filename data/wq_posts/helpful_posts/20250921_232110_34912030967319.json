{
  "title": "【Alpha灵感】股票推荐系统-随机贴现现金流",
  "description": "【Alpha灵感】股票推荐系统-随机贴现现金流 Idea想法 通过随机折现现金流构建企业公允价值分布，计算当前企业价值处于企业公允价值分布中的位置，判断当前企业价值是否被低估，高估，决定买入，卖出。...",
  "post_body": "【Alpha灵感】股票推荐系统-随机贴现现金流\nIdea想法\n通过随机折现现金流构建企业公允价值分布，计算当前企业价值处于企业公允价值分布中的位置，判断当前企业价值是否被低估，高估，决定买入，卖出。\n论文链接：\nhttps://support.worldquantbrain.com/hc/en-us/community/posts/15770966939671-Research-Raper-12-Stock-Recommendations-from-Stochastic-Discounted-Cash-Flows\n原文逻辑\n通过企业未来现金流 作为自变量，企业收入的对数作为因变量构建模型\n将所得模型放入蒙特卡洛模拟得到随机现金流分布\n通过代入企业随机现金流分布到DCF赋值模型，得到企业价值分布\n再计算企业价值分布-各项成本得到股票价值分布\n带入当今股票价值，计算其在分布中的位置，决定是否买入，卖出\n模拟结果\n可以看到论文中的推荐系统可以准确判断当前 股票价值在公允股票价值分布中的位置\n概念解释\n1 企业价值\n完全收购一家企业，市场愿意付出的钱\n这里企业的价值并非看资产值多少钱，而是看企业制造利润的能力。\n2 折现现金流（DCF)\n把未来的现金流 按照资本成本 折算为当前价值。\n假设银行每年利率3.5%,那么1年后的103.5跟现在的100是等值的，dcf就是把未来的现金流折算为当前价值，\n用于评估企业值多少钱。\n3 加权平均资本成本(Weight Average Capital Cost)\n表示每年向资金来源付出的回报占总资本的比率\n一家公司如果单向银行借钱，利率3.5%，那么3.5%就是企业的加权平均资本成本。\n但企业的融资来源一般会有多个,通过计算各来源资本占比以及其预期回报可以得到 企业的加权平均资本成本（wacc)。\nEquity:股权资金\nDebt:债务资金\n4 蒙特卡洛模拟\n通过不断地随机，逼近事物原先的值\nhttps://www.bilibili.com/video/BV1fo4y1977h\n5 DCF估值模型\n在这个模型中，企业价值由未来能产生的现金流决定，第一部分的累加表示 企业在n年内的现金流折算为当前的企业估值-part1，第二部分表示n年之后的现金流折算为当前的企业估值-part2。\nAlpha构建\n1 用回归模型拟合[未来现金流&企业收入]的关系\ncf_margin = (ebitda-capex-(working_capital-last_diff_value(working_capital,504)))/log(revenue);\na = ts_regression(log(revenue),cf_margin,1080,lag=0,rettype=2);\nb = ts_regression(log(revenue),cf_margin,1080,lag=0,rettype=1);\n2 用市场均值作为随机值模拟蒙特卡洛\nx= group_mean(cf_margin,1,market);\n# simulate_log(revenue)\ny=a*x+b;\ncf_random = y*cf_margin;\n3 计算 加权平均资本支出（WACC)\n# wacc\n# risk_market:市场风险\nrisk_market = ts_delta(pv13_revere_index_value,1)/ts_delay(pv13_revere_index_value,1);\n# re:股权风险\nre = fnd6_optrfr+fnd6_beta*(risk_market-fnd6_optrfr);\ne = fnd6_mkvalt;\nd = debt_lt+debt_st;\n# 债务风险\nrd = fnd6_intpn/d;\n# 税收比率\ntc = income_tax / pretax_income;\nv = e + d;\nk= (e/v)*re + (d/v)*rd *(1-tc);\n4 通过DCF估值模型计算 公允企业价值分布\nday=60;\ng= k/5;\nenterprise_value_random = ts_mean(cf_random/signed_power(1+k,ts_step(day)),day)*day + cf_random*(1+g)/(signed_power(1+k,day)*(k-g));\n5 计算当前企业价值位置并根据位置确定 分配权重。\nev_random_mean = ts_mean(enterprise_value_random,1080);\nev_random_dev = ts_std_dev(enterprise_value_random,1080);\nalpha = (enterprise_value-ev_random_mean)/ev_random_dev;\n#此处0.67，以及1.15为论文中0.25与0.125的换算\ntrade_when(abs(alpha)>0.67,if_else(abs(alpha)>1.15,-2*alpha,-alpha),-1)\nAlpha初步结果\n可以看到总体结果还是不错的，作为基本面alpha turnover也很低，说明企业公允价值分布的计算是有效的。\n但sharpe太低了，推测是交易频率门槛过高导致的，考虑降低交易门槛以及增加对于偏离公允价值企业的反应\n降低交易门槛+提升alpha对于信号反应\n在拉低门槛，以及拉高反应后，表现还不如之前，推测是更改了原论文的推荐比例问题，所以这里打算单独提升alpha对于极值的反应.\n单独提升alpha对于信号反应\n结果还是一样，所以没有办法通过简单的降低交易门槛，拉高alpha反应的方式 提升alpha表现，所以接下来打算引入论文中的 横截面推荐系统，将其与当前的单股推荐系统结合得到更强的信号。\n检查 ev_random信号是否有效-排除结果来自trade_when()\n不过在此之前，需要再检查算出的ev_random分布是否有效，于是将其换成data中的enterprise_value,结果如下\n说明 计算出来的ev_random为有效值。\n改进Alpha\n引入论文中横截面推荐系统\nlog_revenue = log(revenue);\ncf_margin = (ebitda-capex-(working_capital-last_diff_value(working_capital,504)))/log(revenue);\na = ts_regression(log_revenue,cf_margin,1080,lag=0,rettype=2);\nb = ts_regression(log_revenue,cf_margin,1080,lag=0,rettype=1);\n# random_value 用市场均值作为随机值\nx= group_mean(cf_margin,1,market);\n# simulate_log(revenue)\ny=a*x+b;\ncf_random = y*cf_margin;\n# wacc 加权平均资本支出\nrisk_market = ts_delta(pv13_revere_index_value,1)/ts_delay(pv13_revere_index_value,1);\nre = fnd6_optrfr+fnd6_beta*(risk_market-fnd6_optrfr);\ne = fnd6_mkvalt;\nd = debt;\nrd = fnd6_intpn/d;\ntc = income_tax / pretax_income;\nv = e + d;\nk= (e/v)*re + (d/v)*rd *(1-tc);\n# DCF估算企业价值\nday=60;\ng= k/5;\nenterprise_value_random = ts_mean(cf_random/signed_power(1+k,ts_step(day)),day)*day + cf_random*(1+g)/(signed_power(1+k,day)*(k-g));\n# 计算当前企业价值所处位置\nev_random_mean = ts_mean(enterprise_value_random,1080);\nev_random_dev = ts_std_dev(enterprise_value_random,1080);\nalpha = (enterprise_value-ev_random_mean)/ev_random_dev;\n# 单股票推荐系统\nssq = trade_when(abs(alpha)>0.67,if_else(abs(alpha)>1.15,-2*alpha,-alpha),-1);\n# 横截面股票推荐系统\nneu_rank_alpha = group_neutralize(rank(alpha),densify(industry));\ncsq = trade_when(abs(neu_rank_alpha)>0.1,neu_rank_alpha,-1);\ncsq+ssq\n可以看到，sharpe增加了，但总体增加不多，可能是横截面推荐系统并没有引入更多的有效信号。\n问题\n如果我后续还要继续改进该alpha应该从哪些方面入手？\nwacc（加权平均资本支出）的计算实在是很繁琐，有没有什么数据字段可以替代的？\n这种跟着论文复现的alpha，应该不具有抽象为模板的能力，那么我们如何从这些论文中获得我们的alpha模板呢？",
  "post_comments": []
}